{extend name="layouts::layout"/}
{block name="content"}
<style>
    .layui-form-item .layui-input-inline{
        width:500px;
    }
    .layui-form-label{
        width:90px;
    }
</style>
    <div class="x-body">
        <div class="layui-container">
            <div class="layui-row">
                <span class="layui-col-md11">公司信息{$title}</span>
                <button class="layui-btn layui-btn-sm back">返回</button>
            </div>

            <hr/>
            <form class="layui-form user-create-form" id="formAdd">
                <div class="layui-form-item">
                    <label for="icon" class="layui-form-label">
                        <span class="x-red"></span>公司icon
                    </label>
                    <div class="layui-input-inline">
                        <input type="file" id="icon" name="icon" required="" lay-verify="icon">
                        <img src="{$company_info['icon']}" class="icon" width="50px">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="wx" class="layui-form-label">
                        <span class="x-red"></span>公司微信
                    </label>
                    <div class="layui-input-inline">
                        <input type="file" id="wx" name="wx" required="" lay-verify="wx">
                        <img src="{$company_info['wx']}" class="wx" width="50px">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="gzh" class="layui-form-label">
                        <span class="x-red"></span>公司微信公众号
                    </label>
                    <div class="layui-input-inline">
                        <input type="file" id="gzh" name="gzh" required="" lay-verify="gzh">
                        <img src="{$company_info['gzh']}" class="gzh" width="50px">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="name" class="layui-form-label">
                        <span class="x-red"></span>公司宣传视频
                    </label>
                    <div class="layui-input-inline">
                        <input type="file" id="video" name="video" required="" lay-verify="video">
                        <video class="video" style="height:50px;vertical-align: middle;" autoplay>
                            <source src="{$company_info['video']}">
                            您的浏览器不支持 HTML5 video 标签。
                        </video>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="name" class="layui-form-label">
                        <span class="x-red">*</span>公司名称
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="name" name="name" required="" lay-verify="name" value="{if isset($info)}{$info->name}{/if}" autocomplete="off" placeholder="输入公司名称" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="english" class="layui-form-label">
                        <span class="x-red"></span>公司英文名称
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="english" name="english" required="" lay-verify="english" value="{if isset($info)}{$info->english}{/if}" placeholder="英文名称" autocomplete="off"class="layui-input">
                    </div>
                    <div class="layui-form-mid layui-word-aux">
                        如若不准，请手动填写
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="qq" class="layui-form-label">
                        <span class="x-red">*</span>公司QQ
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="qq" name="qq" required="" lay-verify="tel" class="layui-input" value="{if isset($info)}{$info->qq}{/if}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="tel" class="layui-form-label">
                        <span class="x-red">*</span>联系方式
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="tel" name="tel" required="" lay-verify="tel" class="layui-input" value="{if isset($info)}{$info->tel}{/if}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="address" class="layui-form-label">
                        <span class="x-red">*</span>公司地址
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="address" name="address" required="" lay-verify="address" class="layui-input" value="{if isset($info)}{$info->address}{/if}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label for="email" class="layui-form-label">
                        <span class="x-red">*</span>公司邮箱
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="email" name="email" required="" lay-verify="email" class="layui-input" value="{if isset($info)}{$info->email}{/if}">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span class="x-red">*</span>公司描述
                    </label>
                    <div id="md-content" class="layui-input-inline" style="width:800px">
                        <textarea name="descrip" id="container" lay-verify="descrip" rows="10" style="width:100%;">{if isset($info)}{$info->descrip}{/if}</textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label  class="layui-form-label">
                    </label>
                    <button  class="layui-btn layui-btn-sm" lay-filter="{$button}" lay-submit="">
                        {$title}
                    </button>
                </div>
            </form>
        </div>
    </div>
<script>
    $("input[name='icon']").change(function(){
        $(".icon").css('width','50px')
        $(".icon").attr("src",URL.createObjectURL($(this)[0].files[0]));
    });
    $("input[name='wx']").change(function(){
        $(".wx").css('width','50px')
        $(".wx").attr("src",URL.createObjectURL($(this)[0].files[0]));
    });
    $("input[name='gzh']").change(function(){
        $(".gzh").css('width','50px')
        $(".gzh").attr("src",URL.createObjectURL($(this)[0].files[0]));
    });
    $("input[name='video']").change(function(){
        $(".video").css('width','50px')
        $(".video").attr("src",URL.createObjectURL($(this)[0].files[0]));
    });
</script>
    <script>
        $('.back').click(function () {
            history.go(-1)
        });

        $('#name').on('blur',function () {
           let word = $(this).val()
            if(word) {
                $.ajax({
                    type: "get",
                    url: "{:url('company/getEnglish')}",
                    data: {
                        word: word
                    },
                    success: function (rel) {
                        var jsonInfo = JSON.parse(rel)
                        var eng = jsonInfo.translateResult[0][0].tgt
                        $('#english').val(eng)
                    }
                })
            }
            return false;
        });

        layui.use(['form','layer'], function(){
            $ = layui.jquery;
            var form = layui.form
            ,layer = layui.layer;
            //自定义验证规则
            var code = '{$info ? 1 : 0}';
            // if(code=='0'){
                form.verify({
                    name: function(value){
                        if(value.length <= 0){
                            return '公司名称必填';
                        }
                    },
                    descrip: function(value){
                        if(value.length <= 0){
                            return '公司描述必填';
                        }
                    },
                    qq: function(value){
                        if(value.length <= 0){
                            return '公司联系方式必填';
                        }
                    },
                    tel: function(value){
                        if(value.length <= 0){
                            return '公司联系方式必填';
                        }
                    },
                    address: function(value){
                        if(value.length <= 0){
                            return '公司地址必填';
                        }
                    },
                    email: function(value){
                        if(value.length <= 0){
                            return '公司邮箱必填';
                        }
                    },
                });
            // }

            //监听提交
            form.on('submit(add)', function(e){
                let data = e.field
                var formData = new FormData($('#formAdd')[0])
                    $.ajax({
                        type: "post",
                        url: "{:url('company/save')}",
                        data:formData,
                        cache:false,
                        processData:false,
                        contentType:false,
                        success: function (rel) {
                            console.log(rel)
                            if(rel.status){
                                layer.msg(rel.msg, {
                                    time: 2000,
                                });
                                self.location = document.referrer;
                            }else{
                                layer.msg(rel.msg, {
                                    time: 2000,
                                });
                            }

                        }
                    })
                return false;
            })

            form.on('submit(update)', function(e){
                let data = e.field
                var formData = new FormData($('#formAdd')[0])
                $.ajax({
                    type:"post",
                    url:"{:url('company/update')}",
                    data:formData,
                    cache:false,
                    processData:false,
                    contentType:false,
                    success:function (rel) {
                        console.log(rel)
                        if(rel.status){
                            layer.msg(rel.msg, {
                                time: 2000,
                            });
                            self.location = document.referrer;
                        }else{
                            layer.msg(rel.msg, {
                                time: 2000,
                            });
                        }

                    }
                })
                return false;
            })
        });
    </script>
    <script>
      //   var _hmt = _hmt || []; (function() {
      //   var hm = document.createElement("script");
      //   hm.src = "https://hm.baidu.com/hm.js?b393d153aeb26b46e9431fabaf0f6190";
      //   var s = document.getElementsByTagName("script")[0];
      //   s.parentNode.insertBefore(hm, s);
      // })();
    </script>
{/block}
